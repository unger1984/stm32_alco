# Наливатор

Программа для управления наливатором под STM32.

> В процессе разработки

Это проект в большей степени учебный. Тут я тренеруюсь кодить под STM32 и FreeRTOS. Ну и работать с периферией. Пробую разные походы в програмировании, изучаю C/C++.

## Железо

Собирал на STM32F401CCU6 (плата типа блэкпилл).
На пины PB5,PB6 и PB7 подключен энкодер с кнопкой (TIM4 CH2 и CH1). На пин PB1 (TIM3 CH4) - сервопривод. На PB8 и PB9 (I2C1) - OLED дисплей 128x64.
На UART6 (пины PA11, PA12) повешен usb-uart для отладки через printf

Еще планируется подключение сенсорных кнопок под рюмки и адресных светодиодов для них же. И, естественно, помпы.

Более подробнее распиновку можно посмотреть в cube32mx/stm32_alco.ioc через STM32Cube32MX

## Описание структуры

Проект конфигурируется в STM32Cube32MX но разработка ведется в Platformio. Для этого в папке cube32mx лежат чистые исходники из куба. Можно открыть cube32mx/stm32_alco.ioc и посмотреть/отредактировать конфигурацию. После этого запустить скрипт fromCube32Mx.py в корне, оно перетащит измененные файлы в директории Platformio.

Для сохранения изменений из Platformio - запускается скрипт toCube32Mx.py - он перенесет измененные файлы обратно в куб. Необходимо контролировать список файлов в этом файле если добавляются новые интерфейсы (например если в кубе добавили spi то его надо прописать в этом скрипте).

## Программа

Программа работает под управлением FreeRTOS. Есть отдельные задачи для сервопривода, энкодера, экрана и прочего. По реализации напишу позже когда доделаю.
